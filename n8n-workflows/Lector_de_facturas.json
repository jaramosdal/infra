{
    "name": "Lector de facturas",
    "nodes": [
        {
            "parameters": {
                "pollTimes": {
                    "item": [
                        {
                            "mode": "everyMinute"
                        }
                    ]
                },
                "simple": false,
                "filters": {
                    "q": "from:clientes@clientesiberdrola.es subject:\"Ya tienes disponible tu factura de electricidad de Iberdrola\" has:attachment"
                },
                "options": {
                    "dataPropertyAttachmentsPrefixName": "attachment_",
                    "downloadAttachments": true
                }
            },
            "type": "n8n-nodes-base.gmailTrigger",
            "typeVersion": 1.3,
            "position": [
                -2080,
                -160
            ],
            "id": "7ce132ef-ea59-408d-8b78-71c1a94a4b7f",
            "name": "Gmail Trigger",
            "credentials": {
                "gmailOAuth2": {
                    "id": "lsfv71kMqWhH5394",
                    "name": "Gmail account"
                }
            }
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 3
                    },
                    "conditions": [
                        {
                            "id": "0d369666-1fdc-49a0-b6b8-d77b28545429",
                            "leftValue": "={{ $binary.attachment_0.fileExtension }}",
                            "rightValue": "pdf",
                            "operator": {
                                "type": "string",
                                "operation": "equals",
                                "name": "filter.operator.equals"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 2.3,
            "position": [
                -1888,
                -160
            ],
            "id": "a80f8ce7-e8b6-4792-9a6f-45bb137ea701",
            "name": "Filter"
        },
        {
            "parameters": {
                "queue": "tareas_facturas",
                "options": {
                    "headers": {
                        "header": [
                            {
                                "key": "proveedor",
                                "value": "iberdrola"
                            }
                        ]
                    }
                }
            },
            "type": "n8n-nodes-base.rabbitmq",
            "typeVersion": 1.1,
            "position": [
                -1392,
                -160
            ],
            "id": "5408f224-8c00-4a3b-86f0-5a19e54ca053",
            "name": "RabbitMQ",
            "credentials": {
                "rabbitmq": {
                    "id": "VvAOaGKnWq2ebqwD",
                    "name": "RabbitMQ account"
                }
            }
        },
        {
            "parameters": {
                "operation": "pdf",
                "binaryPropertyName": "attachment_0",
                "options": {}
            },
            "type": "n8n-nodes-base.extractFromFile",
            "typeVersion": 1.1,
            "position": [
                -1664,
                -160
            ],
            "id": "4be2a07e-dd9d-46d1-9543-765f5bfe6e22",
            "name": "Extract from File"
        }
    ],
    "connections": {
        "Gmail Trigger": {
            "main": [
                [
                    {
                        "node": "Filter",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Filter": {
            "main": [
                [
                    {
                        "node": "Extract from File",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Extract from File": {
            "main": [
                [
                    {
                        "node": "RabbitMQ",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}